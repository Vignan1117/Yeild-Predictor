<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AgriStore - Agriculture Products</title>
  <link rel="stylesheet" href="product.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
</head>
<body>

<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-dark bg-success fixed-top">
  <div class="container">
    <a class="navbar-brand fw-bold" href="#"><img src="products/logo.jpg" alt="" id="logo"> AgriStore</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
        <li class="nav-item"><a class="nav-link active" href="../main/index.html">Home</a></li>
        <li class="nav-item"><a class="nav-link active" href="#products">Products</a></li>
        <li class="nav-item"><a class="nav-link active" href="#about">About</a></li>
        <li class="nav-item"><a class="nav-link active" href="#contact">Contact</a></li>
      </ul>
      <div class="d-flex gap-2 align-items-center">
        <button class="btn btn-outline-light btn-sm" data-bs-toggle="offcanvas" data-bs-target="#cartDrawer">
          <i class="bi bi-cart"></i> <span class="badge bg-danger" id="cartCount">0</span>
        </button>
        <button class="btn btn-outline-light btn-sm" data-bs-toggle="offcanvas" data-bs-target="#wishlistDrawer">
          <i class="bi bi-heart"></i> <span class="badge bg-danger" id="wishlistCount">0</span>
        </button>
        <div id="userSection">
          <button class="btn btn-outline-light btn-sm" data-bs-toggle="modal" data-bs-target="#authModal">
            <i class="bi bi-person-circle"></i> Login
          </button>
        </div>
        <button class="btn btn-outline-light btn-sm" id="themeToggle">
          <i class="bi bi-moon"></i> Dark Mode
        </button>
      </div>
    </div>
  </div>
</nav>

<!-- Carousel -->
<div id="mainCarousel" class="carousel slide mt-5 pt-3" data-bs-ride="carousel">
  <div class="carousel-indicators">
    <button type="button" data-bs-target="#mainCarousel" data-bs-slide-to="0" class="active"></button>
    <button type="button" data-bs-target="#mainCarousel" data-bs-slide-to="1"></button>
    <button type="button" data-bs-target="#mainCarousel" data-bs-slide-to="2"></button>
  </div>
  <div class="carousel-inner">
    <div class="carousel-item active">
      <img src="products/seeds.jpg" class="d-block w-100" alt="Slide 1">
      <div class="carousel-caption d-none d-md-block">
        <h5>Fresh Seeds for Your Garden</h5>
        <p>High-quality seeds for healthy and abundant crops.</p>
      </div>
    </div>
    <div class="carousel-item">
      <img src="products/fertilizer.jpg" class="d-block w-100" alt="Slide 2">
      <div class="carousel-caption d-none d-md-block">
        <h5>Organic Fertilizers</h5>
        <p>Eco-friendly fertilizers for sustainable farming.</p>
      </div>
    </div>
    <div class="carousel-item">
      <img src="products/tools.jpg" class="d-block w-100" alt="Slide 3">
      <div class="carousel-caption d-none d-md-block">
        <h5>Durable Tools</h5>
        <p>High-quality gardening tools for everyday use.</p>
      </div>
    </div>
  </div>
  <button class="carousel-control-prev" type="button" data-bs-target="#mainCarousel" data-bs-slide="prev">
    <span class="carousel-control-prev-icon"></span>
    <span class="visually-hidden">Previous</span>
  </button>
  <button class="carousel-control-next" type="button" data-bs-target="#mainCarousel" data-bs-slide="next">
    <span class="carousel-control-next-icon"></span>
    <span class="visually-hidden">Next</span>
  </button>
</div>
 
<!-- Product Filters -->
<div id="productFilters" class="row mb-4 g-3 align-items-end">
  <!-- ðŸ” Search box -->
  <div class="col-md-3">
    <label for="searchInput" class="form-label">Search Products</label>
    <input type="text" id="searchInput" class="form-control" placeholder="Search by name or description">
  </div>

  <!-- ðŸ”˜ Category filter -->
  <div class="col-md-2">
    <label for="filterCategory" class="form-label">Category</label>
    <select id="filterCategory" class="form-select">
      <option value="">All Categories</option>
      <option value="Seeds">Seeds</option>
      <option value="Fertilizers">Fertilizers</option>
      <option value="Tools">Tools</option>
    </select>
  </div>

  <!-- ðŸ”¢ Price filter -->
  <div class="col-md-2">
    <label class="form-label">Min Price</label>
    <input type="number" id="minPrice" class="form-control" placeholder="0">
  </div>
  <div class="col-md-2">
    <label class="form-label">Max Price</label>
    <input type="number" id="maxPrice" class="form-control" placeholder="100">
  </div>

  <!-- ðŸ”˜ Search button -->
  <div class="col-md-1">
    <button id="searchBtn" class="btn btn-success w-100">Search</button>
  </div>

  <!-- âŒ Clear button -->
  <div class="col-md-1">
    <button id="clearBtn" class="btn btn-danger w-100">Clear</button>
  </div>
</div>



<!-- Products -->
<section id="products" class="py-5">
  <div class="container">
    <h2 class="section-title text-center mb-4">ðŸŒ¾ Our Products</h2>
    <div class="row g-4" id="productList"></div>
  </div>
</section>


<!-- Cart Drawer -->
<div class="offcanvas offcanvas-end" tabindex="-1" id="cartDrawer">
  <div class="offcanvas-header">
    <h5>Shopping Cart</h5>
    <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
  </div>
  <div class="offcanvas-body">
    <ul class="list-group mb-3" id="cartItems"></ul>
    <h6>Total: <span id="cartTotalDrawer">$0.00</span></h6>
    <button class="btn btn-success w-100" id="checkoutBtn">Checkout</button>
  </div>
</div>

<!-- Wishlist Drawer -->
<div class="offcanvas offcanvas-end" tabindex="-1" id="wishlistDrawer">
  <div class="offcanvas-header">
    <h5>Wishlist</h5>
    <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
  </div>
  <div class="offcanvas-body">
    <ul class="list-group mb-3" id="wishlistItems"></ul>
  </div>
</div>

<!-- Product Details Modal -->
<div class="modal fade" id="productDetailsModal" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content shadow">
      <div class="modal-header">
        <h5 class="modal-title" id="detailsTitle">Product Details</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body row">
        <div class="col-md-6 text-center">
          <img id="detailsImg" class="img-fluid rounded shadow" alt="Product Image">
        </div>
        <div class="col-md-6">
          <h4 id="detailsName"></h4>
          <p class="text-muted" id="detailsPrice"></p>
          <p id="detailsRating"></p>
          <p id="detailsDesc"></p>
          <div class="d-flex gap-2 mt-3">
            <button class="btn btn-success" id="detailsAddCart"><i class="bi bi-cart-plus"></i> Add to Cart</button>
            <button class="btn btn-outline-danger" id="detailsAddWishlist"><i class="bi bi-heart"></i> Wishlist</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Login/Register Modal -->
<div class="modal fade" id="authModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content rounded-4 shadow">
      <div class="modal-header">
        <h5 class="modal-title" id="authModalLabel">Login</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <!-- Login Form -->
        <form id="loginForm">
          <div class="mb-3">
            <label>Email</label>
            <input type="email" id="loginEmail" class="form-control" required>
          </div>
          <div class="mb-3">
            <label>Password</label>
            <input type="password" id="loginPassword" class="form-control" required>
          </div>
          <button type="submit" class="btn btn-success w-100">Login</button>
        </form>

        <!-- Register Form -->
        <form id="registerForm" class="d-none">
          <div class="mb-3">
            <label>Full Name</label>
            <input type="text" id="registerName" class="form-control" required>
          </div>
          <div class="mb-3">
            <label>Email</label>
            <input type="email" id="registerEmail" class="form-control" required>
          </div>
          <div class="mb-3">
            <label>Password</label>
            <input type="password" id="registerPassword" class="form-control" required>
          </div>
          <button type="submit" class="btn btn-primary w-100">Register</button>
        </form>
      </div>
      <div class="modal-footer text-center" id="toggleAuth">
        Donâ€™t have an account? <a href="#" id="showRegister">Register</a>
      </div>
    </div>
  </div>
</div>

<!-- About Us -->
<section id="about" class="py-5 bg-light">
  <div class="container">
    <h2>About Us</h2>
    <p>At <strong>AgriStore</strong>, we are dedicated to providing high-quality agricultural products to help farmers, gardeners, and enthusiasts grow healthy crops. Our mission is to support sustainable farming practices and offer eco-friendly solutions for all your gardening needs.</p>
    <div class="row g-4 mt-4">
      <div class="col-md-4">
        <div class="p-4 shadow-sm rounded">
          <h5>Our Mission</h5>
          <p>Promote sustainable farming with top-quality seeds, fertilizers, and tools that nurture growth while protecting the environment.</p>
        </div>
      </div>
      <div class="col-md-4">
        <div class="p-4 shadow-sm rounded">
          <h5>Our Vision</h5>
          <p>Empower farmers and gardeners with innovative products and knowledge to achieve better yields and healthier produce.</p>
        </div>
      </div>
      <div class="col-md-4">
        <div class="p-4 shadow-sm rounded">
          <h5>Our Values</h5>
          <p>Integrity, sustainability, and customer satisfaction are at the heart of everything we do.</p>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Contact -->
<section id="contact" class="py-5">
  <div class="container">
    <h2 class="text-center mb-4">Contact Us</h2>
    <p class="text-center mb-5">Have questions or need support? Reach out to us using the form below or via our contact details.</p>
    <div class="row">
      <div class="col-md-6 mb-4">
        <form id="contactForm">
          <div class="mb-3">
            <label class="form-label">Name</label>
            <input type="text" class="form-control" name="from_name" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Email</label>
            <input type="email" class="form-control" name="reply_to" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Message</label>
            <textarea class="form-control" name="message" rows="5" required></textarea>
          </div>
          <button type="submit" class="btn btn-success w-100">Send Message</button>
        </form>
      </div>
      <div class="col-md-6">
        <h5>Contact Details</h5>
        <p><i class="bi bi-geo-alt-fill"></i> 123 Green Lane, Farmville, Country</p>
        <p><i class="bi bi-telephone-fill"></i> +1 234 567 890</p>
        <p><i class="bi bi-envelope-fill"></i> support@agristore.com</p>
        <div class="mt-4">
          <h6>Follow Us</h6>
          <a href="#" class="me-2"><i class="bi bi-facebook"></i></a>
          <a href="#" class="me-2"><i class="bi bi-twitter"></i></a>
          <a href="#" class="me-2"><i class="bi bi-instagram"></i></a>
          <a href="#"><i class="bi bi-linkedin"></i></a>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Footer -->
<footer class="pt-5 pb-3 mt-5">
  <div class="container text-center">
    <div class="row mb-3">
      <div class="col-md-6 mb-3 mb-md-0">
        <h5 class="mb-2">AgriStore</h5>
        <p>Providing high-quality agricultural products for sustainable farming and gardening.</p>
      </div>
      <div class="col-md-6">
        <h5 class="mb-2">Quick Links</h5>
        <ul class="list-unstyled">
          <li><a href="#products">Products</a></li>
          <li><a href="#about">About</a></li>
          <li><a href="#contact">Contact</a></li>
        </ul>
      </div>
    </div>
    <div class="mb-3">
      <a href="#" class="me-3"><i class="bi bi-facebook fs-5"></i></a>
      <a href="#" class="me-3"><i class="bi bi-twitter fs-5"></i></a>
      <a href="#" class="me-3"><i class="bi bi-instagram fs-5"></i></a>
      <a href="#"><i class="bi bi-linkedin fs-5"></i></a>
    </div>
    <div>
      <small>&copy; 2025 AgriStore. All rights reserved.</small>
    </div>
  </div>
</footer> 
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/emailjs-com@2/dist/email.min.js"></script>
<script>
  (function(){ emailjs.init("O7QIbdsPZtG2YXKp8"); })();
</script>
<script type="module">
  // ============================
// ðŸŒ¾ AGRI TECH STORE SCRIPT
// Firebase + Cart + Wishlist
// ============================
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, updateProfile, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-auth.js";
import { getFirestore, doc, getDoc, setDoc, updateDoc } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-firestore.js";

// ---------------- Firebase Config ----------------
const firebaseConfig = {
  apiKey: "AIzaSyBSJeV-gOAVd-ARx8zS3nZCFDqHyZRdPt8",
  authDomain: "agri-tech-df7bf.firebaseapp.com",
  projectId: "agri-tech-df7bf",
  storageBucket: "agri-tech-df7bf.firebasestorage.app",
  messagingSenderId: "241146284207",
  appId: "1:241146284207:web:c9451239ba8da379c92c5a",
  measurementId: "G-C9XMZWX4RG"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

// ---------------- Global Variables ----------------
let cart = [];
let wishlist = [];

// ---------------- Product Data ----------------
const products = [
  { id: 1, name: "Tomato Seeds", price: 3.5, img: "products/tomatoseed.png" },
  { id: 2, name: "Organic Fertilizer", price: 12.99, img: "products/compost.png" },
  { id: 3, name: "Shovel Tool", price: 18.5, img: "products/tools.jpg" },
  { id: 4, name: "Watering Can", price: 15, img: "products/watercan.png" },
  { id: 5, name: "Corn Seeds", price: 4.5, img: "products/cornseeds.png" },
  { id: 6, name: "Potting Soil", price: 8, img: "products/pottingsoil.png" }
];

// ---------------- Helpers ----------------
function showToast(message, type = "success") {
  console.log(`${type.toUpperCase()}: ${message}`);
  const toast = document.createElement("div");
  toast.className = `alert alert-${type}`;
  toast.textContent = message;
  toast.style.position = "fixed";
  toast.style.top = "10px";
  toast.style.right = "10px";
  toast.style.zIndex = "10000";
  document.body.appendChild(toast);
  setTimeout(() => toast.remove(), 2500);
}

// ---------------- Firestore Helpers ----------------
async function ensureUserDoc(user) {
  const ref = doc(db, "users", user.uid);
  const snap = await getDoc(ref);
  if (!snap.exists()) await setDoc(ref, { cart: [], wishlist: [] });
  return ref;
}

async function saveUserData(user) {
  if (!user) return;
  const ref = await ensureUserDoc(user);
  await updateDoc(ref, { cart, wishlist });
  console.log("âœ… Saved to Firestore:", { cart, wishlist });
}

async function loadUserData(user) {
  const ref = doc(db, "users", user.uid);
  const snap = await getDoc(ref);
  if (snap.exists()) {
    const data = snap.data();
    cart = data.cart || [];
    wishlist = data.wishlist || [];
    console.log("âœ… Loaded from Firestore:", data);
  } else {
    cart = [];
    wishlist = [];
  }
  renderProducts();
  renderCart();
}

// ---------------- Render Products ----------------
function renderProducts() {
  const list = document.getElementById("productList");
  if (!list) return;
  list.innerHTML = "";
  products.forEach(p => {
    const liked = wishlist.some(w => w.id === p.id);
    const card = document.createElement("div");
    card.className = "col-sm-6 col-md-4 col-lg-3";
    card.innerHTML = `
      <div class="card p-3 text-center">
        <img src="${p.img}" class="card-img-top" alt="${p.name}">
        <div class="card-body">
          <h6>${p.name}</h6>
          <p>$${p.price.toFixed(2)}</p>
          <div class="d-flex justify-content-around">
            <button class="btn btn-success btn-sm" data-add="${p.id}">
              <i class="bi bi-cart-plus"></i> Cart
            </button>
            <button class="btn ${liked ? "btn-danger" : "btn-outline-danger"} btn-sm" data-wish="${p.id}">
              <i class="bi bi-heart${liked ? "-fill" : ""}"></i>
            </button>
          </div>
        </div>
      </div>`;
    list.appendChild(card);
  });

  // Add Listeners
  list.querySelectorAll("[data-add]").forEach(btn =>
    btn.addEventListener("click", e => addToCart(Number(e.target.closest("button").dataset.add)))
  );
  list.querySelectorAll("[data-wish]").forEach(btn =>
    btn.addEventListener("click", e => toggleWishlist(Number(e.target.closest("button").dataset.wish)))
  );
}

// ---------------- Cart ----------------
function renderCart() {
  const list = document.getElementById("cartItems");
  const totalEl = document.getElementById("cartTotalDrawer");
  const countEl = document.getElementById("cartCount");
  if (!list) return;
  list.innerHTML = "";
  let total = 0;
  cart.forEach(item => {
    total += item.price * item.qty;
    const li = document.createElement("li");
    li.className = "list-group-item d-flex justify-content-between align-items-center";
    li.innerHTML = `${item.name} Ã— ${item.qty}<span>$${(item.price * item.qty).toFixed(2)}</span>`;
    list.appendChild(li);
  });
  if (totalEl) totalEl.textContent = "$" + total.toFixed(2);
  if (countEl) countEl.textContent = cart.reduce((s, c) => s + c.qty, 0);
}

async function addToCart(id) {
  const p = products.find(x => x.id === id);
  if (!p) return;
  const existing = cart.find(c => c.id === id);
  if (existing) existing.qty++;
  else cart.push({ ...p, qty: 1 });
  renderCart();
  showToast(`${p.name} added to cart!`);
  if (auth.currentUser) await saveUserData(auth.currentUser);
}

// ---------------- Wishlist ----------------
async function toggleWishlist(id) {
  const idx = wishlist.findIndex(w => w.id === id);
  if (idx > -1) {
    wishlist.splice(idx, 1);
    showToast("Removed from wishlist", "danger");
  } else {
    const p = products.find(x => x.id === id);
    wishlist.push(p);
    showToast("Added to wishlist", "info");
  }
  renderProducts();
  if (auth.currentUser) await saveUserData(auth.currentUser);
}

// ---------------- Authentication ----------------
const loginForm = document.getElementById("loginForm");
const registerForm = document.getElementById("registerForm");
const authModalLabel = document.getElementById("authModalLabel");
const toggleAuth = document.getElementById("toggleAuth");
const userSection = document.getElementById("userSection");

function switchToLogin() {
  loginForm.classList.remove("d-none");
  registerForm.classList.add("d-none");
  authModalLabel.textContent = "Login";
  toggleAuth.innerHTML = `Donâ€™t have an account? <a href="#" id="showRegister">Register</a>`;
  document.getElementById("showRegister").onclick = e => {
    e.preventDefault();
    switchToRegister();
  };
}

function switchToRegister() {
  loginForm.classList.add("d-none");
  registerForm.classList.remove("d-none");
  authModalLabel.textContent = "Register";
  toggleAuth.innerHTML = `Already have an account? <a href="#" id="showLogin">Login</a>`;
  document.getElementById("showLogin").onclick = e => {
    e.preventDefault();
    switchToLogin();
  };
}

// Register
registerForm?.addEventListener("submit", async e => {
  e.preventDefault();
  const name = document.getElementById("registerName").value;
  const email = document.getElementById("registerEmail").value;
  const pwd = document.getElementById("registerPassword").value;
  try {
    const userCred = await createUserWithEmailAndPassword(auth, email, pwd);
    await updateProfile(userCred.user, { displayName: name });
    await ensureUserDoc(userCred.user);
    showToast("Registered successfully!");
    switchToLogin();
  } catch (err) {
    showToast(err.message, "danger");
  }
});

// Login
loginForm?.addEventListener("submit", async e => {
  e.preventDefault();
  const email = document.getElementById("loginEmail").value;
  const pwd = document.getElementById("loginPassword").value;
  try {
    await signInWithEmailAndPassword(auth, email, pwd);
    showToast("Login successful!");
    const modal = bootstrap.Modal.getInstance(document.getElementById("authModal"));
    modal?.hide();
  } catch (err) {
    showToast("Login failed: " + err.message, "danger");
  }
});

// Auth state
onAuthStateChanged(auth, async user => {
  if (user) {
    userSection.innerHTML = `
      <span class="text-light me-2">Hi, ${user.displayName || user.email}</span>
      <button class="btn btn-outline-light btn-sm" id="logoutBtn">Logout</button>`;
    document.getElementById("logoutBtn").onclick = async () => {
      await signOut(auth);
      showToast("Logged out", "info");
    };
    await loadUserData(user);
  } else {
    userSection.innerHTML = `
      <button class="btn btn-outline-light btn-sm" data-bs-toggle="modal" data-bs-target="#authModal">
        <i class="bi bi-person-circle"></i> Login
      </button>`;
    cart = [];
    wishlist = [];
    renderProducts();
    renderCart();
  }
});

// ---------------- Initialize ----------------
document.addEventListener("DOMContentLoaded", () => {
  renderProducts();
  renderCart();
  switchToLogin();
});

</script>

</body>
</html>
